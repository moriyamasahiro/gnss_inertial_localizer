#include "ekf.hpp"

void ekf::get_jaccobian_h_with_lgnss(){
  Eigen::MatrixXf jaccobian_h(6, 16);

  Eigen::MatrixXf s = ekf::state.state;

  jaccobian_h << 1, 0, 0, 0, 0, 0, 0.12*s(8,0), 0.12*s(9,0), 0.12*s(6,0) + 1.04*s(8,0), 0.12*s(7,0) + 1.04*s(9,0), 0, 0, 0, 0, 0, 0,
                 0, 1, 0, 0, 0, 0, -0.12*s(7,0) - 0.52*s(9,0), -0.12*s(6,0) - 0.52*s(8,0), -0.52*s(7,0) + 0.12*s(9,0), -0.52*s(6,0) + 0.12*s(8,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 1, 0, 0, 0, 0.52*s(8,0), -0.24*s(7,0) - 0.52*s(9,0), 0.52*s(6,0) - 0.24*s(8,0), -0.52*s(7,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.060, 0,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0.060, 0, 0.26,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, -0.26, 0;

  ekf::jaccobian_h = jaccobian_h;
}

void ekf::get_jaccobian_h_with_rgnss(){
  Eigen::MatrixXf jaccobian_h(6, 16);

  Eigen::MatrixXf s = ekf::state.state;

  jaccobian_h << 1, 0, 0, 0, 0, 0, 0.12*s(8,0), 0.12*s(9,0), 0.12*s(6,0) - 1.04*s(8,0), 0.12*s(7,0) - 1.04*s(9,0), 0, 0, 0, 0, 0, 0,
                 0, 1, 0, 0, 0, 0, -0.12*s(7,0) + 0.52*s(9,0), -0.12*s(6,0) + 0.52*s(8,0), 0.52*s(7,0) + 0.12*s(9,0), 0.52*s(6,0) + 0.12*s(8,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 1, 0, 0, 0, -0.52*s(8,0), -0.24*s(7,0) + 0.52*s(9,0), -0.52*s(6,0) - 0.24*s(8,0), 0.52*s(7,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.060, 0,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0.060, 0, -0.26,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0.26, 0;

  ekf::jaccobian_h = jaccobian_h;
}

void ekf::get_jaccobian_h_imu_init(){
  Eigen::MatrixXf jaccobian_h(10, 16);

  Eigen::MatrixXf s = ekf::state.state;
  Eigen::MatrixXf u = ekf::imu_output;

  jaccobian_h << 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.060, 0.26, 0, 0, 0, 0, 0.060, -0.26,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0.0600000000000000, 0, 0, 0, 0, 0, -0.0600000000000000, 0, 0,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -26.0, 0, 0,
                 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -5.0, 26.0,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 5.0, 0, 0,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -26.0, 0, 0,
                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (s(10,0) - u(0,0))/sqrt(pow(-s(10,0) + u(0,0),2) + pow(-s(11,0) + u(1,0),2) + pow(-s(12,0) + u(2,0),2)), (s(11,0) - u(1,0))/sqrt(pow(-s(10,0) + u(0,0),2) + pow(-s(11,0) + u(1,0),2) + pow(-s(12,0) + u(2,0),2)), (s(12,0) - u(2,0))/sqrt(pow(-s(10,0) + u(0,0),2) + pow(-s(11,0) + u(1,0),2) + pow(-s(12,0) + u(2,0),2)), 0, 0, 0,
                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0,
                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0,
                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1;

  ekf::jaccobian_h_imu_init = jaccobian_h;
}

void ekf::get_jaccobian_h_gnss_init(){
  Eigen::MatrixXf jaccobian_h(12, 16);

  Eigen::MatrixXf s = ekf::state.state;

  jaccobian_h <<1, 0, 0, 0, 0, 0, 10.0*s(8,0) - 52.0*s(9,0), 52.0*s(8,0) + 10.0*s(9,0), 10.0*s(6,0) + 52.0*s(7,0), -52.0*s(6,0) + 10.0*s(7,0), 0, 0, 0, 0, 0, 0,
                 0, 1, 0, 0, 0, 0, -10.0*s(7,0), -10.0*s(6,0) - 104.0*s(7,0), 10.0*s(9,0), 10.0*s(8,0) - 104.0*s(9,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 1, 0, 0, 0, 52.0*s(7,0), 52.0*s(6,0) - 20.0*s(7,0), -20.0*s(8,0) + 52.0*s(9,0), 52.0*s(8,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -5.0, 26.0,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 5.0, 0, 0,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -26.0, 0, 0,
                 1, 0, 0, 0, 0, 0, 10.0*s(8,0) - 52.0*s(9,0), 52.0*s(8,0) + 10.0*s(9,0), 10.0*s(6,0) + 52.0*s(7,0), -52.0*s(6,0) + 10.0*s(7,0), 0, 0, 0, 0, 0, 0,
                 0, 1, 0, 0, 0, 0, -10.0*s(7,0), -10.0*s(6,0) - 104.0*s(7,0), 10.0*s(9,0), 10.0*s(8,0) - 104.0*s(9,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 1, 0, 0, 0, 52.0*s(7,0), 52.0*s(6,0) - 20.0*s(7,0), -20.0*s(8,0) + 52.0*s(9,0), 52.0*s(8,0), 0, 0, 0, 0, 0, 0,
                 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -5.0, 26.0,
                 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 5.0, 0, 0,
                 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -26.0, 0, 0;

  ekf::jaccobian_h_gnss_init = jaccobian_h;
}
